<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Identity & Age Verification</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 2rem; }
    .container { background: white; padding: 2rem; max-width: 500px; margin: auto; border-radius: 8px; }
    input, button { width: 100%; padding: 0.75rem; margin-top: 1rem; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    .error { color: red; margin-top: 1rem; }
    .success { color: green; margin-top: 1rem; }


  </style>
</head>
<body>
  <div class="container">
    <h2>Get Identity and Age</h2>
    <form id="verifyForm">
      <button type="submit">Get Person Identity</button>

      <div id="identityInfo" style="display: none;">
        <div colspan="2">
        <label for="given_name">Full Name:</label>
        <input type="text" id="given_name"/>
        </div>

      <label for="family_name">Family Name:</label>
      <input type="text" id="family_name"/>

      <label for="is_age_over_21">is age over 21:</label>
        <image id="is_age_over_21" width="20" height="15"/>
        
    <label for="potrait">potrait</label>    
        <img id="potrait" src="" width="70" height="70" alt="Red dot" />
      </div>

    </form>
    <p id="result"></p>
  </div>

  <script>


    document.getElementById("verifyForm").addEventListener("submit",async function(e) {
      e.preventDefault();
      try {
    // A hardcoded sample request is provided below.
    // This request would normally be built on your server.
        const mdocRequest = {
            "deviceRequest": "omd2ZXJzaW9uYzEuMGtkb2NSZXF1ZXN0c4GibGl0ZW1zUmVxdWVzdNgYWIyiZ2RvY1R5cGV1b3JnLmlzby4xODAxMy41LjEubURMam5hbWVTcGFjZXOic29yZy5hYW12YS4xODAxMy41LjGhZ3JlYWxfaWT0cW9yZy5pc28uMTgwMTMuNS4xpGhwb3J0cmFpdPRqZ2l2ZW5fbmFtZfVrZmFtaWx5X25hbWX1a2FnZV9vdmVyXzIx9GpyZWFkZXJBdXRohEOhASahGCFZCCMwgggfMIIGB6ADAgECAhEApmFTpyB9AhhuLqhLf0ay4jANBgkqhkiG9w0BAQsFADCBuTETMBEGCgmSJomT8ixkARkWA29yZzEaMBgGCgmSJomT8ixkARkWCm1hc3RlcmNhcmQxCzAJBgNVBAYTAkJFMR0wGwYDVQQKExRNYXN0ZXJDYXJkIFdvcmxkd2lkZTEkMCIGA1UECxMbR2xvYmFsIEluZm9ybWF0aW9uIFNlY3VyaXR5MTQwMgYDVQQDEytNYXN0ZXJDYXJkIFBSRCBDb3Jwb3JhdGUgTmV0d29yayBSb290IENBIEcyMB4XDTE0MTIwODEwMjYxMFoXDTM0MTIwODEwMjYxMVowgbkxEzARBgoJkiaJk_IsZAEZFgNvcmcxGjAYBgoJkiaJk_IsZAEZFgptYXN0ZXJjYXJkMQswCQYDVQQGEwJCRTEdMBsGA1UEChMUTWFzdGVyQ2FyZCBXb3JsZHdpZGUxJDAiBgNVBAsTG0dsb2JhbCBJbmZvcm1hdGlvbiBTZWN1cml0eTE0MDIGA1UEAxMrTWFzdGVyQ2FyZCBQUkQgQ29ycG9yYXRlIE5ldHdvcmsgUm9vdCBDQSBHMjCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBALRTX7dMCn6UwjscgcGMCfB96UhfChmxu0_SnX18D0WgId8zq_7EVoq1QscaUtIhrWVWuZyVvrF_qH-36pcaJLupMygwil5Vuk6vmS9w59Kf9894xWSBMStvntti7OUQZwvK4aohu8l5Md11PAgRIIJkiHN7xfLeMXgniCBNoXkmmP7AUpyr8ig8GslVPhfhlKQOm_Fd_7YGwSc7SM69SibS1rPW1QWXimswreuVR0BxN9HGQdplm2_wi5umbopPeYOhCkHWUkE8OODIcwqQjrJjzUoFfjLojRD8RMH-7Q1l-aczLBk3iaQJDGGoBWH7uiNEWlPKsc4rYYPBSKgOKqEins7yXLKlCGqzbaVYEhbXjCq5ab5iiiZFsRL8urMkIHljuyh4hEXiSZpaGBeH90rtC4aWHu1P0tuAircYmcdv_IYlydb28RccOnmVvXIG__YhL5MZMJfjvtxl3ui0HiIWuJEIZl3T26QoCYEvfhFiFLqs0sMT-eMo0oklkHB2x-pZEmDOfRZoF_kmvJZLJ0FMcM4bgduR-qTZNZGiFjQPDKLxzzl9L4KSxF3RWRaRw__TkWHCwJCgeImBwwYnpxgjT4Az9a60WwoTxaC5Y9M9BEyILAXRRqQ4-naPwHOTwFX6HOz2LXvLNkJhBQgKtCLBqChb9veE2yarDtAZV3_DAgMBAAGjggIeMIICGjCCAbIGA1UdHwSCAakwggGlMIHwoIHtoIHqhoHnbGRhcDovLy9DTj1NYXN0ZXJDYXJkJTIwUFJEJTIwQ29ycG9yYXRlJTIwTmV0d29yayUyMFJvb3QlMjBDQSUyMEcyLENOPUNvcnBvcmF0ZVJvb3QsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9bWFzdGVyY2FyZCxEQz1vcmc_Y2VydGlmaWNhdGVSZXZvY2F0aW9uTGlzdD9iYXNlP29iamVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50MFegVaBThlFodHRwOi8vY29ycHBraS5tYXN0ZXJjYXJkLm9yZy9jcmwvTWFzdGVyQ2FyZC1QUkQtQ29ycG9yYXRlLU5ldHdvcmstUm9vdC1DQS1HMi5jcmwwV6BVoFOGUWh0dHA6Ly9wcm9kcGtpLm1hc3RlcmNhcmQub3JnL2NybC9NYXN0ZXJDYXJkLVBSRC1Db3Jwb3JhdGUtTmV0d29yay1Sb290LUNBLUcyLmNybDAOBgNVHQ8BAf8EBAMCAYYwEgYDVR0TAQH_BAgwBgEB_wIBATAdBgNVHQ4EFgQUuAqDrDqEzTrkJlW9BcSIw6D6TcQwHwYDVR0jBBgwFoAUuAqDrDqEzTrkJlW9BcSIw6D6TcQwDQYJKoZIhvcNAQELBQADggIBAKI1Fabd5RN6yU-0SRJ54kuJhpsnZwYNkYGuqKGVNP1LbrA2jFyEEr58iqsJ3i2Qmwj2nSR3KW2_mLknDMkycJ7SK87ro7WzAqcuLUu84QT9fDT6bBWM25lOoK8ZPh9kpibAwkGN-B3YcinoVHA7BByKN3ynYMzifqvGvKV2frJHOhePVV47GqHOHZsWftF8xFXdFGAB4uKBo-S2En3oSZw7cUmIOFxeIK9QP2ws53k1CfOznpjNkuwBi5nToRB5zKnnChWfX0uhFw1MEtKP3uKCUEFBPxWptso68MQ5h6Wd9e98TZsumxbpKvnVJmD4RmMQX-g9CXtNgNG8Oj-xajok8yh1h6eIWuqEav9A_xEaEckStZx3g7nZB7YUO0W1yDGyXuP4I1YB7RtCi_dCFYFEvoMWW3KrIlpRf64kU9kDaJrSC1ECbnhEaJs8b5xC8lQa4wCCGuwUMF8VC-On9BMTjTO0N92aAwvROPlD5ErbXM1-3qkhMu6dVVCoaJTJniDN3hB-o_CZQlw5hIp5-TZeje2OlHVc-9dQvx1Yt67hwVq1MJItrmV41kahzpL3QWhtQzd_IQn04nI71f7rrMQhGK9hr6Kt3rHtG9nd0AJGloVbT5ZlpbGD0H-DxSGuwpcmDgtI-UedNvUnivZAdPZcnce5G8tJU2Trp2chscZs9lhAUns2l0pJt8kTqlRfLt8s3KIFAdzIHv3qZFS1pa-lc9xBeNQ_5qTd3aZOX5IxCqnsaHVylx1jI-CPeTlivmjzOQ==",
        "encryptionInfo": "gmVkY2FwaaJlbm9uY2VYIPlv505ZK3Y93ZZhO-Wi4HqqHWHismrehHtGtNx3fxOxcnJlY2lwaWVudFB1YmxpY0tleaQBAiABIVggrlztqHsaR_OK3Npf8eTvG6AZWNxJsb69ZTFIPJcUR-0iWCCbWR3FyNPy2ysLKoiTysxI7LjxvcRnfNsB-JLDNmZdDw"
        }
        
        const request = {
            mediation: "required",
            digital: {
                requests: [{
                    protocol: "org-iso-mdoc",
                    data: mdocRequest
                }]
            }
        };
        console.log(request)
        
        const response = await navigator.credentials.get(request);
        // Send the response to your server for handling.
        console.log(response)
        console.log(response.data)
        let responseString = base64URLdecode(response.data.response)
        const jsonObject = JSON.parse(responseString);
        document.getElementById("identityInfo").style.display="block";
        document.getElementById("given_name").value = jsonObject["given_name"];
        document.getElementById("family_name").value = jsonObject["family_name"];
        if(jsonObject["age_over_21"]) {
            document.getElementById("is_age_over_21").src="https://raw.githubusercontent.com/PKief/vscode-markdown-checkbox/main/logo.png" 
        }
        if(jsonObject["portrait"]) {
            document.getElementById("portrait").src=jsonObject["portrait"]
        }

    } catch (error) {
        // Use an alternative identity verification method.
        console.log(error)
    }
    });
    function base64URLdecode(str) {
    const base64Encoded = str.replace(/-/g, '+').replace(/_/g, '/');
    const padding = str.length % 4 === 0 ? '' : '='.repeat(4 - (str.length % 4));
    const base64WithPadding = base64Encoded + padding;
    return atob(base64WithPadding)
        .split('')
        .map(char => String.fromCharCode(char.charCodeAt(0)))
        .join('');
    }
  </script>
</body>
</html>
